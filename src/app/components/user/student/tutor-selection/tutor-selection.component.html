<div class="container">
    <p-toast />
    <div class="row">
        <div class="col-md-12">
            <!-- Toolbar with Title, Count, and Search -->
            <p-toolbar styleClass="bg-white">
                <div class="p-toolbar-group-start">
                    <!-- Title and Count -->
                    <div class="d-flex flex-column justify-content-start align-item-center">
                        <div class="d-flex align-item-center fs-5 fw-bolder">
                            View Tutors
                            <span class="badge rounded-pill text-bg-secondary d-flex align-items-center ms-1"
                                *ngIf="currentAvailableTutor > 0">{{currentAvailableTutor}}</span>
                        </div>
                        <div class="text-muted">Select tutor which match's your requirement and enroll with him/her to
                            make your future more bright.
                        </div>
                    </div>
                </div>
                <div class="p-toolbar-group-end">
                    <!-- Search Input and Add New Button -->
                    <div class="form-group">
                        <input type="text" id="globalFilter" class="form-control" [(ngModel)]="filters.Query"
                            (input)="onGlobalFilterTutor($event)" placeholder="Search" />
                    </div>
                </div>
            </p-toolbar>
        </div>
    </div>
    <div class="d-flex justify-content-between align-items-center mt-2">
        <div class="form-group me-2 w-100">
            <p-dropdown [options]="days" inputId="days" [filter]="true" [filterBy]="'label'" [optionLabel]="'label'"
                [optionValue]="'value'" name="days" placeholder="Filter by Day" [(ngModel)]="filters.Day"
                [showClear]="true" (onChange)="onDayChange($event)">
            </p-dropdown>
        </div>
        <div class="form-group me-2 w-100">
            <p-dropdown [options]="Subjects" inputId="subject" [filter]="true" [filterBy]="'label'"
                [optionLabel]="'label'" [optionValue]="'value'" name="subjects" placeholder="Filter by Subject"
                [(ngModel)]="filters.SubjectId" [showClear]="true" (onChange)="onSubjectChange($event)">
            </p-dropdown>
        </div>
        <div class="form-group me-2 w-100">
            <p-dropdown [options]="Grades" inputId="grade" [filter]="true" [filterBy]="'label'" [optionLabel]="'label'"
                [optionValue]="'value'" name="grades" placeholder="Filter by Grade" [(ngModel)]="filters.Grade"
                [showClear]="true" (onChange)="onGradeChange($event)">
            </p-dropdown>
        </div>
        <div class="form-group me-2 w-100">
            <p-dropdown [options]="TimeGroup" inputId="starttime" [filter]="true" [filterBy]="'label'"
                [optionLabel]="'label'" [optionValue]="'value'" name="timegroup"
                placeholder="Filter by Time Availability" [(ngModel)]="filters.StartTime" [showClear]="true"
                (onChange)="onStartTimeChange($event)">
            </p-dropdown>
        </div>
        
        <!-- Clear All Filters Button -->
        <div class="form-group me-2 w-100">
            <p-button type="button" icon="pi pi-times" iconPos="left" [outlined]="true" severity="secondary"
                (click)="clearAllFilters($event)" class=" p-button-sm" label="Clear All"></p-button>
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-md-12">
            <div class="wrapper">
                <ng-container *ngFor="let tutor of availableTutor">
                    <div class="card" (click)="navigateTutorDetailPage(tutor)">
                        <div class="profile">
                            <img (click)="navigateTutorDetailPage(tutor)"
                                [src]="tutor.ImgUrl ? tutor.ImgUrl : '../../../../assets/user-profile.png'"
                                [alt]="tutor.FullName">
                            <div class="name">{{tutor.Hon}} {{tutor.FullName}}</div>
                        </div>
                        <img class="background-image"
                            [src]="tutor.ImgUrl ? tutor.ImgUrl : '../../../../assets/user-profile.png'"
                            [alt]="tutor.FullName">

                        <div class="info px-4">
                            <h1>About</h1>
                            <p>A highly knowledgeable educator with a Master of Science degree, specializing in
                                providing advanced scientific and mathematical instruction.</p>
                        </div>
                    </div>
                </ng-container>
            </div>
            <!--Card Design-->
            <!-- <div class="container">
                <div class="row text-center gap-1">
                    <ng-container *ngFor="let tutor of availableTutor">
                        <div class="tutor-card mt-3">
                            <div class="py-2 d-flex border border-1 border-top-0 border-start-0 border-end-0">
                                <div style="width: 20%;" class="d-flex align-items-center ms-2">
                                    <a (click)="navigateTutorDetailPage(tutor)" > <img [src]="tutor.ImgUrl ? tutor.ImgUrl : '../../../../assets/user-profile.png'" [alt]="tutor.FullName" style="width: 75px; height: 75px;" class="rounded-circle"/></a>                              
                                </div>
                                <div style="width:55%" class="d-flex h-100 flex-column justify-content-center text-start">
                                    <a (click)="navigateTutorDetailPage(tutor)"><h5 class="m-0 ms-2 text-muted">{{tutor.Hon}} {{tutor.FullName}}</h5></a>
                                    <p class="m-0 ms-2 text-muted">{{tutor.Email}}</p>
                                    <p class="m-0 ms-2 text-muted">{{tutor.Qualifications}}</p>
                                </div>
                                <div style="width: 25%;" class="d-flex align-items-end text-end pb-2 px-2">
                                    <button (click)="enrollStudentRequest(tutor)" class="enroll-btn">Enroll</button>
                                </div>
                            </div>
                            <div class="mt-2 border border-1 border-top-0 border-start-0 border-end-0">
                                <h5 class="m-0 ps-2 pb-2 text-muted text-start">Description</h5>
                                <p class="px-2 text-start">A highly knowledgeable educator with a Master of Science degree, specializing in providing advanced scientific and mathematical instruction.</p>
                            </div>
                            <div class="mt-2 border border-1 border-top-0 border-start-0 border-end-0">
                                <h5 class="m-0 ps-2 pb-2 text-muted text-start">Grades</h5>
                                <p class="text-muted ps-2 text-start">{{tutor.Hon}}{{tutor.FullName}} teaches the following subjects <a class="text-primary cursor-pointer" (click)="showSubjectDialogueBox($event, tutor)">view subjects</a></p>
                            </div>

                            <div class="my-2 border border-1 border-top-0 border-start-0 border-end-0 ">
                                <h5 class="m-0 ps-2 pb-2 font-semibold text-muted text-start border border-1 border-top-0 border-end-0 border-start-0 ">Availability</h5>
                                <div class="d-flex justify-content-between border border-1 border-top-0 border-end-0 border-start-0">
                                    <h6 class="m-0 py-2 ps-2 w-25 text-start text-muted border border-1 border-top-0 border-bottom-0 border-start-0">Day</h6>
                                    <h6 class="m-0 py-2 ps-2 w-75 text-start text-muted">Time Stamp</h6>
                                </div>
                                <div class="d-flex flex-column justify-content-start align-text-left" *ngFor="let availability of tutor.TutorAvailabilities; let isFirst = first">   
                                    <ng-container *ngIf="availability.Day == currentDayAbbreviation" >
                                        <div  class="d-flex flex-column border border-1 border-top-1 border-start-0 border-end-0 border-bottom-0">
                                            <div class="d-flex justify-content-between">
                                                <p class="w-25 text-sm-start mb-0 py-2 ps-2 border border-1 border-top-0 border-start-0 border-bottom-0">{{availability.Day}} </p>
                                                <p class="w-75 text-sm-start mb-0 py-2 ps-2 text-start mx-auto">{{formatTimeTo12Hours(availability.OpenTimeHours, availability.OpenTimeMinutes)}} —— {{formatTimeTo12Hours(availability.CloseTimeHours, availability.CloseTimeMinutes)}}</p>
                                            </div>
                                        </div>  
                                    </ng-container>
                                </div>  
                            </div>
                        </div>
                    </ng-container>
                </div>
            </div> -->
        </div>

        <!-- <div class="col-md-3">
            <p-panel>
                <ng-template pTemplate="header">
                    <div class="row text-center">
                        <h3 class="col-12 font-weight-bold">My Subjects</h3>
                        <p class="col-12 font-weight-bold">Charlotte Smith:</p>
                        <p><b>School Type:</b> Secondary <b>Year</b>: 8</p>
                    </div>
                </ng-template>
                <div *ngFor="let subject of Subjects">
                    <h3 class="col-12 font-weight-bold">{{ subject }}</h3>
                    <div class="col-12 drop-column" pDroppable="tutors" (onDrop)="drop($event,subject)">
                        <p-table [value]="getSelectedTutorsBySubject(subject)">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th>Image</th>
                                    <th>Name</th>
                                    <th>Action</th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-tutor>
                                <tr>
                                    <td><img 
                                        src="https://primefaces.org/cdn/primeng/images/demo/product/{{ tutor.Image }}" 
                                        [alt]="tutor.FullName" 
                                        class="img-thumbnail w-100"/></td>
                                    <td>{{tutor.FullName}}</td>
                                    <td>
                                        <button (click)="deselectProduct(tutor, subject)" class="btn btn-danger">X</button>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                    </div>
                </div>
            </p-panel>
        </div> -->

    </div>
</div>
<p-dialog header="Subjects" [modal]="true" [(visible)]="showSubjectDialogue" [style]="{width:'600px'}">
    <div class="text-center " *ngIf="selectedTutor">
        <p>List of All subject {{(!selectedTutor.Hon ? "" : selectedTutor.Hon + ".") + " " + selectedTutor.FullName}}
            teaches</p>
    </div>
    <div class="mt-3 d-flex justify-content-around border border-2 rounded-top-2 ">
        <h5 class="w-50 text-center border border-2 border-top-0 border-bottom-0 border-start-0 mb-0">Subject Name</h5>
        <h5 class="w-50 text-center">Grades</h5>
    </div>
    <div class="d-flex flex-column border border-2 border-top-0 rounded-bottom-2 mb-3">
        <div class="d-flex justify-content-between" *ngFor="let subject of selectedTutorSubjects; let last = last"
            [ngClass]="{'border border-2 border-start-0 border-top-0 border-end-0': !last && subject.SubjectName}">
            <p *ngIf="subject.SubjectName"
                class="ps-3 w-50 border border-2 border-top-0 border-bottom-0 border-start-0 mb-0">
                {{subject.SubjectName}}</p>
            <div *ngIf="subject.SubjectName" class="ps-3 w-50 d-flex gap-3">
                <p *ngFor="let Grade of subject.Grades"> {{ Grade.GradeLevel > 3 ? Grade.GradeLevel + 'th' :
                    Grade.GradeLevel === 1 ? Grade.GradeLevel + 'st' : Grade.GradeLevel === 2 ? Grade.GradeLevel + 'nd'
                    : Grade.GradeLevel === 3 ? Grade.GradeLevel + 'rd': 'Not Found' }}
                <p>
            </div>
        </div>
    </div>
    <div class="text-end">
        <p-button label="close" severity="primary" (click)="showSubjectDialogue = false"
            [style]="{borderRadius:'3px', width:'75px'}" />
    </div>
</p-dialog>